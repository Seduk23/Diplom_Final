{% extends 'base.html' %}
{% load i18n course_tags %}

{% block title %}{% trans "Teacher Dashboard" %}{% endblock %}

{% block content %}
<div class="container mt-5" data-aos="fade-up">
    <h1 class="mb-4">{% trans "My Courses" %}</h1>
    {% include 'partials/messages.html' %}

    <h3>{% trans "Your Courses" %}</h3>
    {% if courses %}
        <div class="list-group mb-4">
            {% for course in courses %}
                <div class="list-group-item" data-aos="fade-up">
                    <h5>{{ course.title }}</h5>
                    <p>{{ course.description|truncatewords:20 }}</p>
                    <a href="{% url 'courses:course_edit' pk=course.id %}" class="btn btn-sm btn-warning">{% trans "Edit Course" %}</a>
                    <a href="{% url 'courses:manage_lessons' course_id=course.id %}" class="btn btn-sm btn-primary">{% trans "Manage Lessons" %}</a>
                    <a href="{% url 'courses:course_detail' course_id=course.id %}" class="btn btn-sm btn-info">{% trans "View Course" %}</a>
                    <a href="{% url 'courses:delete_course' course_id=course.id %}" class="btn btn-sm btn-danger">{% trans "Delete Course" %}</a>
                </div>
            {% endfor %}
        </div>

        <h2 class="mt-5 mb-4">{% trans "Student Test Results" %}</h2>
        {% for course in courses %}
            <div class="card mb-4" data-aos="fade-up">
                <div class="card-body">
                    <h5 class="card-title">{{ course.title }}</h5>
                    {% if test_results|get_item:course.id %}
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>{% trans "Student" %}</th>
                                    <th>{% trans "Lesson" %}</th>
                                    <th>{% trans "Score" %}</th>
                                    <th>{% trans "Attempts" %}</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for result in test_results|get_item:course.id %}
                                    <tr>
                                        <td>{{ result.student__username }}</td>
                                        <td>{{ result.lesson__title }}</td>
                                        <td>{{ result.score }}%</td>
                                        <td>{{ result.attempts }}</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <p class="text-muted">{% trans "No test results yet." %}</p>
                    {% endif %}
                </div>
            </div>
        {% endfor %}
    {% else %}
        <div class="alert alert-info" data-aos="fade-up">
            {% trans "You have not created any courses." %}
            <a href="{% url 'courses:course_create' %}" class="alert-link">{% trans "Create a course" %}</a>
        </div>
    {% endif %}
</div>
{% endblock %}